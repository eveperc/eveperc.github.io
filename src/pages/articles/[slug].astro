---
import Layout from "../../layouts/Layout.astro";
import { Blog, generateTableOfContent } from "../../components/Blog";
import { Breadcrumbs } from "../../components/Breadcrumbs";
import { newtClient } from "../../lib/newt";
import type { Article } from "../../lib/newt";

export const getStaticPaths = async () => {
  const { items: articles } = await newtClient.getContents<Article>({
    appUid: "blog",
    modelUid: "article",
    query: {
      select: ["title", "slug", "body", "category", "coverImage", "updatedAt"],
    },
  });
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
};
type Props = {
  article: Article;
};
const { article } = Astro.props;
const toc: string = generateTableOfContent(article.body);
const updatedAt = new Date(article.updatedAt).toLocaleString("ja");
---

<Layout id="blogDetail" title={article.title} description="投稿詳細ページです">
  <Breadcrumbs title={article.title} />
  <div class="main content">
    <figure class="bg-white flex justify-center max-h-96">
      <img class="max-w-sm" src={article.coverImage.src} alt={article.coverImage.altText}/>
    </figure>
    <div class="my-10 grid grid-cols-4 grid-rows-6">
      <h2 class="col-span-4 row-span-4 text-5xl font-bold">{article.title}</h2>
      <div class="col-span-2 text-lg font-bold badge badge-outline">{updatedAt}</div>
      <div class="col-span-2 text-lg font-bold badge badge-secondary">{article.category.name}</div>
    </div>
    <div id="blog_toc" set:html={toc} />
    <Blog body={article.body} />
  </div>
</Layout>
