---
import Layout from "../../layouts/Layout.astro";
import { Blog } from "../../components/Blog";
import { BlogBody, generateTableOfContent } from "../../components/ParseOfBody";
import { Breadcrumbs } from "../../components/Breadcrumbs";
import { newtClient } from "../../lib/newt";
import type { Article } from "../../lib/newt";

export const getStaticPaths = async () => {
  const { items: articles } = await newtClient.getContents<Article>({
    appUid: "blog",
    modelUid: "article",
    query: {
      select: ["title", "slug", "body", "category", "coverImage", "updatedAt"],
    },
  });
  return articles.map((article) => ({
    params: { slug: article.slug },
    props: { article },
  }));
};
type Props = {
  article: Article;
};
const { article } = Astro.props;
const toc: string = generateTableOfContent(article.body);
const updatedAt = new Date(article.updatedAt).toLocaleString("ja");
---

<Layout id="detail" title={article.title} description="投稿詳細ページです">
  <Breadcrumbs>
    <Breadcrumbs.ul>
      <Breadcrumbs.li><a href="/">Home</a></Breadcrumbs.li>
      <Breadcrumbs.li>{article.title}</Breadcrumbs.li>
    </Breadcrumbs.ul>
  </Breadcrumbs>
  <Blog.Toc html={toc} />
  <Blog>
    <Blog.Image>
      <img
        class="max-w-sm"
        src={article.coverImage.src}
        alt={article.coverImage.altText}
      />
    </Blog.Image>
    <div class="my-10">
      <Blog.Title>{article.title}</Blog.Title>
      <div class="flex justify-around items-center">
        <Blog.UpdatedAt>
          最終更新日：{updatedAt}
        </Blog.UpdatedAt>
        <Blog.Category>
          {article.category.name}
        </Blog.Category>
      </div>
    </div>
    <Blog.Body>
      <BlogBody body={article.body} />
    </Blog.Body>
  </Blog>
</Layout>
